<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Duplicador de imagen ‚Äî 1150√ó1800</title>
<style>
  :root{
    --bg:#111;
    --card:#161616;
    --accent:#2ecc71;
    --text:#eee;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Arial,Helvetica,sans-serif}
  .wrap{max-width:1100px;margin:28px auto;padding:20px;background:linear-gradient(180deg,#0f0f0f 0%, #141414 100%);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  h1{margin:0 0 14px;font-size:20px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label.btn{
    display:inline-flex;gap:8px;align-items:center;padding:10px 14px;border-radius:8px;background:var(--card);cursor:pointer;border:1px solid #222;
  }
  input[type=file]{display:none}
  select,input[type=range],input[type=number]{background:#0d0d0d;color:var(--text);border:1px solid #222;padding:8px;border-radius:6px}
  button.action{background:var(--accent);color:#042; padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  #canvasWrap{margin-top:20px;display:flex;gap:16px;align-items:flex-start}
  #previewCanvas{background:#fff;border:1px solid #222;box-shadow:0 8px 24px rgba(0,0,0,0.6)}
  .controls{min-width:220px}
  small.muted{color:#999;display:block;margin-top:6px}
  .footer{margin-top:16px;color:#999;font-size:13px}
  .row-between{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Duplicador de imagen ‚Äî lienzo 1150 √ó 1800</h1>

    <div class="row">
      <label class="btn">
        üìÅ Subir imagen
        <input id="fileInput" type="file" accept="image/*">
      </label>

      <label class="btn" id="btnReset">
        ‚ôªÔ∏è Limpiar
      </label>

      <button class="action" id="btnDownload">‚¨áÔ∏è Descargar PNG</button>
    </div>

    <div style="height:12px"></div>

    <div class="row">
      <div style="flex:1">
        <div class="row" style="gap:8px;margin-bottom:8px;align-items:center">
          <label style="display:flex;gap:8px;align-items:center">
            Layout:
            <select id="layoutSelect" style="margin-left:6px">
              <option value="vertical">Vertical (apiladas)</option>
              <option value="horizontal">Horizontal (lado a lado)</option>
              <option value="grid">Grid 2√ó1 (dos copias centradas)</option>
            </select>
          </label>

          <label style="display:flex;gap:8px;align-items:center">
            Fondo:
            <input type="color" id="bgColor" value="#ffffff" style="margin-left:6px;height:36px;width:56px;padding:0;border-radius:6px;border:1px solid #222">
          </label>

          <label style="display:flex;gap:8px;align-items:center">
            Margen (%):
            <input id="marginRange" type="range" min="0" max="30" value="4" style="width:160px;margin-left:8px">
            <input id="marginNum" type="number" min="0" max="30" value="4" style="width:62px;margin-left:6px">
          </label>
        </div>

        <small class="muted">La imagen se duplicar√° y se escalar√° manteniendo proporci√≥n. Puedes probar distintos layouts y m√°rgenes. El PNG descargado ser√° 1150√ó1800.</small>
      </div>

      <div class="controls">
        <div class="row-between" style="margin-bottom:8px">
          <div>Previsualizaci√≥n</div>
          <div style="opacity:0.8;font-size:13px">1150 √ó 1800</div>
        </div>
        <div id="canvasWrap">
          <canvas id="previewCanvas" width="460" height="720"></canvas>
        </div>
      </div>
    </div>

    <div class="footer">Hecho con ‚ù§Ô∏è ‚Äî copia/ajusta libremente.</div>
  </div>

<script>
/*
  Duplicador de im√°genes en canvas 1150x1800
  - sube imagen
  - dibuja dos copias escaladas (vertical/horizontal/grid)
  - bajar como PNG al tama√±o final 1150x1800
*/

const fileInput = document.getElementById('fileInput');
const previewCanvas = document.getElementById('previewCanvas');
const ctx = previewCanvas.getContext('2d');

const layoutSelect = document.getElementById('layoutSelect');
const bgColorInput = document.getElementById('bgColor');
const marginRange = document.getElementById('marginRange');
const marginNum = document.getElementById('marginNum');
const btnDownload = document.getElementById('btnDownload');
const btnReset = document.getElementById('btnReset');

let img = null;

// constants final export size
const FINAL_W = 1150;
const FINAL_H = 1800;

// preview canvas scaling (keeps aspect ratio, but preview canvas used for UX)
const PREVIEW_W = previewCanvas.width;
const PREVIEW_H = previewCanvas.height;

function clearPreview() {
  ctx.fillStyle = bgColorInput.value;
  ctx.fillRect(0,0,PREVIEW_W, PREVIEW_H);
  // guide cross
  ctx.save();
  ctx.strokeStyle = "rgba(0,0,0,0.06)";
  ctx.lineWidth = 1;
  ctx.strokeRect(0.5,0.5,PREVIEW_W-1,PREVIEW_H-1);
  ctx.restore();
}
clearPreview();

fileInput.addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if (!f) return;
  const url = URL.createObjectURL(f);
  const image = new Image();
  image.onload = () => {
    img = image;
    drawPreview();
    URL.revokeObjectURL(url);
  };
  image.onerror = () => { alert("No se pudo leer la imagen"); URL.revokeObjectURL(url); }
  image.src = url;
});

marginRange.addEventListener('input', ()=>{
  marginNum.value = marginRange.value;
  drawPreview();
});
marginNum.addEventListener('change', ()=>{
  let v = Number(marginNum.value);
  if (isNaN(v)) v = 0;
  v = Math.max(0, Math.min(30, v));
  marginNum.value = v;
  marginRange.value = v;
  drawPreview();
});

layoutSelect.addEventListener('change', drawPreview);
bgColorInput.addEventListener('change', drawPreview);

btnReset.addEventListener('click', ()=>{
  img = null;
  fileInput.value = "";
  clearPreview();
});

btnDownload.addEventListener('click', ()=>{
  if (!img) { alert("Primero sube una imagen"); return; }
  // crear canvas final
  const c = document.createElement('canvas');
  c.width = FINAL_W; c.height = FINAL_H;
  const C = c.getContext('2d');
  // fondo
  C.fillStyle = bgColorInput.value;
  C.fillRect(0,0,FINAL_W,FINAL_H);

  // dibujar dos copias con misma l√≥gica que preview pero a tama√±o final
  drawTwoCopies(C, FINAL_W, FINAL_H, img, layoutSelect.value, Number(marginNum.value));

  // descargar como PNG
  c.toBlob(function(blob){
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `duplicado_${Date.now()}.png`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }, 'image/png', 1);
});

// l√≥gica de dibujado (preview usa coordenadas del preview canvas)
function drawPreview(){
  clearPreview();
  if (!img) return;

  // usamos el mismo algoritmo pero escalado a preview size
  drawTwoCopies(ctx, PREVIEW_W, PREVIEW_H, img, layoutSelect.value, Number(marginRange.value));
}

/**
 * Dibuja dos copias en el contexto ctx, que tiene tama√±o w√óh.
 * layout: 'vertical' | 'horizontal' | 'grid'
 * marginPercent: 0..30 indicating padding around each copy (percent of half-dimension)
 */
function drawTwoCopies(ctxObj, w, h, imageObj, layout, marginPercent){
  // background must be set by caller
  // compute per-copy target rect depending on layout
  ctxObj.save();
  // clear & background
  // Only fill if ctxObj is the preview ctx (we already cleared before calling preview)
  // Caller ensures background fill for final canvas
  if (ctxObj === ctx) {
    ctxObj.fillStyle = bgColorInput.value;
    ctxObj.fillRect(0,0,w,h);
  }

  const margin = Math.max(0, Math.min(30, marginPercent)) / 100;

  function fitRectAndDraw(img, dstX, dstY, dstW, dstH) {
    // Fit image into dstW x dstH preserving aspect ratio and centered
    const iw = img.naturalWidth || img.width;
    const ih = img.naturalHeight || img.height;
    const ratio = Math.min(dstW / iw, dstH / ih);
    const drawW = Math.round(iw * ratio);
    const drawH = Math.round(ih * ratio);
    const offsetX = Math.round(dstX + (dstW - drawW) / 2);
    const offsetY = Math.round(dstY + (dstH - drawH) / 2);
    ctxObj.drawImage(img, offsetX, offsetY, drawW, drawH);
  }

  if (layout === 'vertical') {
    // two stacked halves (top and bottom)
    const halfH = h / 2;
    const innerW = w * (1 - margin*2);
    const innerH = halfH * (1 - margin*2);
    const x = w * margin;
    const yTop = halfH * margin;
    const yBottom = halfH + halfH * margin;
    // draw top
    fitRectAndDraw(imageObj, x, yTop, innerW, innerH);
    // draw bottom
    fitRectAndDraw(imageObj, x, yBottom, innerW, innerH);
  } else if (layout === 'horizontal') {
    // side by side halves (left and right)
    const halfW = w / 2;
    const innerW = halfW * (1 - margin*2);
    const innerH = h * (1 - margin*2);
    const xLeft = halfW * margin;
    const xRight = halfW + halfW * margin;
    const y = h * margin;
    fitRectAndDraw(imageObj, xLeft, y, innerW, innerH);
    fitRectAndDraw(imageObj, xRight, y, innerW, innerH);
  } else {
    // grid (two centered boxes, like vertical but with spacing)
    const boxW = w * 0.9;
    const boxH = (h / 2) * 0.9;
    const x = (w - boxW) / 2;
    const gap = 12 * (w / 1150); // visual gap scaled
    fitRectAndDraw(imageObj, x,  (h/2 - boxH)/2, boxW, boxH);
    fitRectAndDraw(imageObj, x,  (h/2 - boxH)/2 + boxH + gap, boxW, boxH);
  }

  ctxObj.restore();
}

// Responsive: scale preview canvas to fit container width while preserving aspect ratio
(function makePreviewResponsive(){
  const wrap = document.getElementById('canvasWrap');
  function resize() {
    const maxW = Math.min(520, window.innerWidth - 420); // leave room for controls
    const scale = Math.max(0.3, Math.min(1, maxW / PREVIEW_W));
    previewCanvas.style.width = Math.round(PREVIEW_W * scale) + "px";
    previewCanvas.style.height = Math.round(PREVIEW_H * scale) + "px";
  }
  window.addEventListener('resize', resize);
  resize();
})();

</script>
</body>
</html>
